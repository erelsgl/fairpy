#!python3
"""
    Some tests for the min-sharing algorithm.

    Programmer: Eliyahu Sattat
    Since:  2020
"""


import numpy as np
import datetime

from fairpy.items.min_sharing_impl.ConsumptionGraph import ConsumptionGraph
from fairpy.items.min_sharing_impl.FairEnvyFreeAllocationProblem import FairEnvyFreeAllocationProblem
from fairpy.items.min_sharing_impl.FairProportionalAllocationProblem import FairProportionalAllocationProblem
from fairpy.items.min_sharing_impl.GraphGenerator import GraphGenerator


def is_envy_free(v,z):
    for i in range(len(v)):
        agent_sum = 0
        for j in range(len(v[0])):
            agent_sum += z[i][j] * v[i][j]
        anther_agent_sum = 0
        for j in range(len(v)):
            anther_agent_sum = 0
            for k in range(len(v[0])):
                anther_agent_sum += z[j][k] * v[i][k]
            if(agent_sum < anther_agent_sum):
                print("the agent {}".format(i))
                print("the anther_agent {}".format(j))
                #return False
    return True

if __name__ == '__main__':
    num_of_agents = 4
    num_of_items = 10
    max_item_value = 100
    v = np.random.randint(max_item_value, size=(num_of_agents, num_of_items)).tolist()

    v =  [[150., 150. ,150. ,150., 150. ,250.],
         [150., 150. ,150. ,150., 150. ,250.],
         [150., 150. ,150. ,150., 150. ,250.]]


    fpap = FairEnvyFreeAllocationProblem(v)
    fpap1 =  FairProportionalAllocationProblem(v)
    print(v)
    start = datetime.datetime.now()
    # THE TEST EXECUTION
    ans = fpap.find_allocation_with_min_sharing()
    #ans = fpap1.find_allocation_with_min_sharing()
    print(ans)
    print(is_envy_free(v, ans))
    end = datetime.datetime.now()
    # print("the number of graph: {}".format(count))
    print("Total time for {} agents and {} items  :{}".format(num_of_agents, num_of_items, end - start))

    """
    /////////////////////////////////bug inputs////////////////////////////
    
    
     v = [[300. ,300. ,400.],
         [307. ,308. ,385.],
         [312., 313. ,375.]]
         
        v = [[555., 444., 1.],
         [589., 410., 1.],
         [610., 389., 1.]]
         
         
         v = [[166. ,166. ,166. ,166. ,166. ,170.], his 333.328
        [166. ,166. ,166. ,166. ,166. ,170.], his 333.162
        [166. ,166. ,166. ,166. ,166. ,170.]] his 333.008
        
        ans: (prop and envy)
        [[1.    1.    0.008 0.    0.    0.   ]
         [0.    0.    0.    0.497 1.    0.498]
         [0.    0.    0.991 0.502 0.    0.501]]
         
         
         after some fix:
      v = [[166., 166., 166., 166., 166., 170.],333.328 
         [166., 166., 166., 166., 166., 170.],333.328
         [166., 166., 166., 166., 166., 170.]]333.178
         
         
          v =  [[242. ,322. ,157. ,188.  ,91.  , 0.],
         [257. ,330. ,137.,186.  ,90.  , 0.],
         [265., 339. ,136., 185. , 75. ,  0.]]
         
         
    v =  [[300., 300.,400.],
         [307. ,308. ,385.],
         [312. ,313., 375.]]
         
        v = [[413., 587.],
            [427. ,573.],
            [397., 603.]]

    v =[[397. ,603.],
       [484. ,516.],
       [374., 626.]]
       
    v = [[416., 584.],
        [422., 578.],
        [349. ,651.]]
        
    v =  [[150., 150. ,150. ,150., 150. ,250.],
         [150., 150. ,150. ,150., 150. ,250.],
         [150., 150. ,150. ,150., 150. ,250.]]
    prop ans:
    [[1.    1.    0.222 0.    0.    0.   ]
   [0.    0.    0.    0.444 0.999 0.466]
 [0.    0.    0.777 0.555 0.    0.533]]
 
 v =   [[340. ,230. ,220., 210.],
 [270. ,260. ,240. ,230.],
 [400. ,200., 200. ,200.]]

 
 
 
    /////////////////////////////////end bug inputs////////////////////////////
    
    
    
    
    
    
    [[37, 32, 70, 12],
     [33, 0, 55, 85], 
     [32, 83, 35, 35], 
     [13, 16, 39, 90]]
     
     
     [[0.    0.    1.    0.   ]
     [1.    0.    0.    0.358]
     [0.    1.    0.    0.   ]
     [0.    0.    0.    0.641]]
    Total time for 4 agents and 4 items  :0:00:01.979707
    
    
    
    [[59, 36, 62, 29, 57]
    , [95, 81, 66, 54, 66]
    , [20, 33, 81, 73, 26]
    , [25, 15, 95, 86, 11]]
    
    
    [[0.319 0.    0.    0.    1.   ]
    [0.296 1.    0.    0.    0.   ]
    [0.    0.    0.999 0.    0.   ]
    [0.383 0.    0.    1.    0.   ]]
    Total time for 4 agents and 5 items  :0:00:03.255364


    [[34, 36, 77, 3, 98, 30],
    [19, 29, 52, 7, 68, 24],
    [46, 84, 28, 78, 48, 85],
    [34, 1, 55, 20, 59, 58]]
    
    [[0.    0.    1.    0.    0.109 0.   ]
    [0.    0.    0.    0.    0.89  0.   ]
    [0.    1.    0.    1.    0.    0.   ]
    [1.    0.    0.    0.    0.    1.   ]]
    Total time for 4 agents and 6 items  :0:00:01.182875
    
    
    
    [[41, 33, 90, 92, 71, 87, 91],
    [65, 30, 75, 56, 46, 14, 95],
    [66, 15, 15, 32, 89, 47, 9],
    [96, 46, 64, 75, 20, 51, 16]]
    
    [[0.    0.    0.743 1.    0.    0.    0.   ]
     [0.    0.    0.256 0.    0.    0.    1.   ]
     [0.    0.    0.    0.    0.999 0.999 0.   ]
     [1.    1.    0.    0.    0.    0.    0.   ]]
     Total time for 4 agents and 7 items  :0:00:01.977783
     
     
     
     
     [[42, 32, 76, 81, 67, 46, 94, 0, 14, 71],
     [38, 2, 10, 4, 52, 62, 53, 1, 19, 99], 
     [35, 29, 99, 21, 84, 56, 37, 29, 61, 56],
     [42, 25, 29, 88, 14, 47, 44, 86, 24, 39]]
       
       
       [[0.    0.    0.    1.    0.    0.    1.    0.    0.    0.   ]
        [0.    0.    0.    0.    0.    0.999 0.    0.    0.    0.999]
        [0.    0.    0.999 0.    1.    0.    0.    0.    0.    0.   ]
        [0.999 1.    0.    0.    0.    0.    0.    0.999 0.999 0.   ]]
        Total time for 4 agents and 10 items  :0:00:37.752878



































v = [[1,2,3,4],[4,5,6,5],[6,7,9,8]]
[[0.    0.    0.    0.999]
 [0.623 0.999 0.    0.   ]
 [0.376 0.    0.999 0.   ]]
Total time for 3 agents and 4 items  :0:00:00.188497



[[0.999 0.    1.    0.    1.    0.    0.    0.    0.    0.   ]
 [0.    0.    0.    0.    0.    1.    0.    1.    0.    0.   ]
 [0.    0.    0.    0.    0.    0.    1.    0.    1.    1.   ]
 [0.    1.    0.    1.    0.    0.    0.    0.    0.    0.   ]]
Total time for 4 agents and 10 items  :0:21:33.373481




    a = ConsumptionGraph([[0. ,   0.    ,0.   , 1.  ,  0.   , 0.   , 0.   , 0.999 ,0.    ,0.   ],
    [0.   , 0.   , 0.  ,  0.   , 0.999 ,0.  ,  0.   , 0.   , 0.   , 0.999],
    [0.   , 0.999 ,1.   , 0.   , 0.   , 0.   , 0.   , 0.   , 0.   , 0.   ],
    [1.  ,  0.   , 0.   , 0.   , 0.    ,1. ,   1.   , 0.   , 0.999 ,0.   ]])
    print(a.is_prop([[17, 52, 45, 61, 41, 38, 41, 66, 57, 45], [36, 28, 34, 50, 67, 39, 38, 45, 94, 94], [35, 85, 74, 92, 0, 46, 48, 2, 78, 49], [54, 11, 66, 51, 39, 79, 86, 99, 88, 23]]))



[[9, 23, 19, 62, 66, 75, 44, 28, 56, 27, 61, 56, 69, 91, 8, 40, 96, 22, 70, 15], [98, 68, 87, 60, 32, 20, 30, 9, 64, 0, 62, 20, 97, 22, 64, 64, 87, 28, 26, 31], [19, 47, 51, 12, 17, 90, 21, 49, 69, 16, 64, 49, 70, 0, 73, 25, 49, 96, 34, 55], [12, 14, 83, 53, 47, 27, 51, 6, 39, 8, 80, 91, 66, 72, 71, 10, 58, 26, 94, 19]]
[[0.    0.    0.    0.    0.999 0.    0.    0.    0.    0.    0.    0.
  0.    1.    0.    0.    0.999 0.    0.    0.   ]
 [0.999 1.    0.    1.    0.    0.    0.    0.    0.    0.    0.    0.
  0.    0.    0.    0.999 0.    0.    0.    0.   ]
 [0.    0.    0.    0.    0.    1.    0.    1.    0.    0.    0.    0.
  0.    0.    0.    0.    0.    0.999 0.    0.   ]
 [0.    0.    0.999 0.    0.    0.    0.999 0.    1.    1.    1.    0.999
  1.    0.    1.    0.    0.    0.    1.    1.   ]]
Total time for 4 agents and 20 items  :0:08:13.528924






envy-free 

[[0.    0.    0.    1.    0.    0.    0.    0.    0.    0.    0.    1.
  1.    0.    0.   ]
 [0.    0.    0.    0.    0.    1.    0.    0.    0.    0.999 0.    0.
  0.    0.999 0.   ]
 [0.999 0.    0.    0.    0.999 0.    0.999 0.    0.    0.    0.999 0.
  0.    0.    0.   ]
 [0.    0.999 0.999 0.    0.    0.    0.    0.999 0.999 0.    0.    0.
  0.    0.    0.999]]
Total time for 4 agents and 15 items  :0:04:42.596165


[[0.    0.    0.    0.999 0.    0.    0.    0.    0.    0.    0.999 0.
  0.999 0.    0.    0.    0.    0.    0.999 0.   ]
 [0.    0.    0.    0.    0.    0.    0.    0.    0.    0.999 0.    0.
  0.    0.    0.    0.    0.999 0.999 0.    0.999]
 [1.    1.    1.    0.    0.    0.    1.    0.    1.    0.    0.    0.
  0.    0.    0.    0.    0.    0.    0.    0.   ]
 [0.    0.    0.    0.    1.    1.    0.    1.    0.    0.    0.    1.
  0.    1.    1.    1.    0.    0.    0.    0.   ]]
Total time for 4 agents and 20 items  :0:40:02.282783


   # v = [[333. ,333. ,334.],
    #    [333. ,334. ,333.]]
    v =  [[300. ,300., 400.],
          [307. ,308., 385.],
          [312. ,313. ,375.]]
    """